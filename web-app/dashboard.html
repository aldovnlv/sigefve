<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>SIGEFVE - Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#f4f6f9; --card:#fff; --accent:#2b6cb0; }
    body { margin:0; font-family:Inter, Arial, sans-serif; background:var(--bg); color:#1f2937;}
    header { background:var(--card); padding:12px 20px; display:flex; align-items:center; justify-content:space-between; box-shadow:0 1px 0 rgba(0,0,0,0.04); }
    header h2 { margin:0; font-size:18px; }
    main { display:flex; gap:16px; padding:16px; }
    .col-left { flex:2; display:flex; flex-direction:column; gap:12px; }
    .col-right { flex:1; display:flex; flex-direction:column; gap:12px; }
    .card { background:var(--card); border-radius:10px; padding:12px; box-shadow:0 6px 18px rgba(20,30,40,0.04);}
    #map { height:380px; border-radius:8px; background: linear-gradient(180deg,#e6f0ff,#f7fbff); position:relative; display:flex; align-items:center; justify-content:center; color:#7b8794;}
    .stats { display:flex; gap:12px; }
    .stat { flex:1; padding:10px; border-radius:8px; background:linear-gradient(180deg,#fff,#fbfdff); text-align:center;}
    ul.lista-vehiculos { list-style:none; margin:0; padding:0; max-height:420px; overflow:auto;}
    li.vehiculo { display:flex; justify-content:space-between; padding:8px 10px; border-bottom:1px solid #eef2f6; align-items:center;}
    .badge { padding:6px 8px; border-radius:6px; font-size:12px; background:#eef2ff; color:#134e9b;}
    .alerta { padding:8px; border-radius:6px; margin-bottom:8px;}
    .urgente { background:#ffe6e6; border-left:4px solid #e02424;}
    .media { background:#fff7e6; border-left:4px solid #e08a00;}
    .baja { background:#eef8ff; border-left:4px solid #2b6cb0;}
    .btn { display:inline-block; padding:8px 10px; border-radius:8px; background:var(--accent); color:white; text-decoration:none; }
  </style>
</head>
<body>
  <header>
    <h2>SIGEFVE - Dashboard</h2>
    <div>
      <span id="usuarioDisplay"></span>
      <button id="logout" class="btn" style="background:#e53e3e;margin-left:10px">Cerrar sesión</button>
    </div>
  </header>

  <main>
    <section class="col-left">
      <div class="card stats">
        <div class="stat">
          <div style="font-size:12px;color:#6b7280">Total km (hoy)</div>
          <div style="font-size:20px;font-weight:700" id="totalKm">--</div>
        </div>
        <div class="stat">
          <div style="font-size:12px;color:#6b7280">Entregas hoy</div>
          <div style="font-size:20px;font-weight:700" id="entregasHoy">--</div>
        </div>
        <div class="stat">
          <div style="font-size:12px;color:#6b7280">Vehículos disponibles</div>
          <div style="font-size:20px;font-weight:700" id="vehDisponibles">--</div>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0">Mapa (simulado)</h3>
        <div id="map">Mapa simulado — marcadores de vehículos</div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0">Lista de vehículos</h3>
        <ul id="listaVehiculos" class="lista-vehiculos"></ul>
      </div>
    </section>

    <aside class="col-right">
      <div class="card">
        <h3 style="margin:0 0 8px 0">Alertas activas</h3>
        <div id="alertasContainer">
          <!-- alertas -->
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0">Acciones</h3>
        <a href="rutas.html" class="btn">Crear / Asignar ruta</a>
      </div>
    </aside>
  </main>

  <script>
    // Simulación de token y usuario
    const token = localStorage.getItem('sigefve_token');
    const usuario = localStorage.getItem('sigefve_usuario') || 'Operador';

    document.getElementById('usuarioDisplay').textContent = usuario;
    document.getElementById('logout').addEventListener('click', () => {
      localStorage.removeItem('sigefve_token');
      localStorage.removeItem('sigefve_usuario');
      window.location.href = 'login.html';
    });

    // Datos simulados de vehículos
    const vehiculos = [
      {id:'VAN-001', tipo:'Van', estado:'EN_RUTA', nivelBateria:65, lat:19.4326, lon:-99.1332, ultimo:'2025-10-12T08:30:00Z'},
      {id:'BIKE-002', tipo:'Bicicleta', estado:'DISPONIBLE', nivelBateria:45, lat:19.435, lon:-99.13, ultimo:'2025-10-12T08:32:00Z'},
      {id:'MOTO-003', tipo:'Moto', estado:'CARGANDO', nivelBateria:18, lat:19.431, lon:-99.135, ultimo:'2025-10-12T08:28:00Z'}
    ];

    function renderLista() {
      const ul = document.getElementById('listaVehiculos');
      ul.innerHTML = '';
      vehiculos.forEach(v => {
        const li = document.createElement('li');
        li.className = 'vehiculo';
        li.innerHTML = `
          <div>
            <div style="font-weight:700">${v.id} <span style="font-weight:400;color:#6b7280">(${v.tipo})</span></div>
            <div style="font-size:12px;color:#6b7280">Última: ${new Date(v.ultimo).toLocaleString()}</div>
          </div>
          <div style="text-align:right">
            <div class="badge">${v.estado}</div>
            <div style="font-size:13px;margin-top:6px">${v.nivelBateria}%</div>
            <div style="margin-top:6px"><a href="vehiculo.html?id=${encodeURIComponent(v.id)}" class="btn" style="background:#1a202c">Detalle</a></div>
          </div>
        `;
        ul.appendChild(li);
      });
    }

    function renderStats() {
      document.getElementById('totalKm').textContent = '1,240';
      document.getElementById('entregasHoy').textContent = '78';
      document.getElementById('vehDisponibles').textContent = vehiculos.filter(v => v.estado === 'DISPONIBLE').length;
    }

    function renderAlertas() {
      const container = document.getElementById('alertasContainer');
      container.innerHTML = '';
      const alertas = [
        {id:1, nivel:'URGENTE', texto:'Moto MOTO-003 batería 18%'},
        {id:2, nivel:'MEDIA', texto:'Van VAN-001 temperatura motor 72°C'},
      ];
      alertas.forEach(a => {
        const div = document.createElement('div');
        div.className = 'alerta ' + (a.nivel === 'URGENTE' ? 'urgente' : 'media');
        div.innerHTML = `<strong>${a.nivel}</strong> — ${a.texto}`;
        container.appendChild(div);
      });
    }

    // Mapa simulado: mostrar puntos como pequeños marcadores dentro del div
    function renderMapa() {
      const map = document.getElementById('map');
      map.innerHTML = '';
      const w = map.clientWidth, h = map.clientHeight;
      const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
      svg.setAttribute('width', '100%');
      svg.setAttribute('height', '100%');

      // Simple background grid
      const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
      rect.setAttribute('width','100%'); rect.setAttribute('height','100%'); rect.setAttribute('fill','#f7fbff');
      svg.appendChild(rect);

      // Place markers (normalized)
      vehiculos.forEach((v, i) => {
        const cx = 30 + (i*120 % (w-60));
        const cy = 60 + (i*80 % (h-120));
        const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
        circle.setAttribute('cx', cx); circle.setAttribute('cy', cy); circle.setAttribute('r', 10);
        circle.setAttribute('fill', v.nivelBateria < 20 ? '#e53e3e' : '#2b6cb0');
        svg.appendChild(circle);
        const text = document.createElementNS('http://www.w3.org/2000/svg','text');
        text.setAttribute('x', cx + 14); text.setAttribute('y', cy + 4); text.setAttribute('font-size', '12');
        text.setAttribute('fill','#0f172a'); text.textContent = v.id;
        svg.appendChild(text);
      });

      map.appendChild(svg);
    }

    // Inicialización
    renderLista();
    renderStats();
    renderAlertas();
    renderMapa();

  </script>
</body>
</html>
